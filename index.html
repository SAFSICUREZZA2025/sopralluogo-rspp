
<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Rapporto di Sopralluogo</title>
<link rel="manifest" href="manifest.json"/>
<style>
:root{--b:#0b5fff;--k:#111827;--m:#6b7280;--bg:#f6f8fb;--bd:#e5e7eb}
*{box-sizing:border-box} html,body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--k);overscroll-behavior:contain}
.wrap{max-width:1100px;margin:auto;padding:20px}
.card{background:#fff;border:1px solid var(--bd);border-radius:14px;padding:16px;margin:14px 0}
h1{margin:8px 0 0;color:var(--b)} h3{margin:0 0 8px}
.row{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
.row>label{min-width:240px;display:flex;gap:8px;align-items:center}
input[type=text],input[type=password],input[type=date],textarea{border:1px solid var(--bd);border-radius:10px;padding:10px}
textarea{width:100%;min-height:110px}
table{width:100%;border-collapse:collapse;background:#fff}
th,td{border:1px solid var(--bd);padding:8px;text-align:left;vertical-align:top}
th{background:var(--b);color:#fff}
button{background:var(--b);color:#fff;border:0;border-radius:10px;padding:10px 14px;cursor:pointer}
button.secondary{background:#111827}
canvas{border:1px dashed #9ca3af;border-radius:10px;background:#fff;touch-action:none}
.login{min-height:100vh;display:grid;place-items:center}
.panel{width:min(520px,92vw);background:#fff;border:1px solid var(--bd);border-radius:16px;padding:20px}
.note{color:var(--m);font-size:.9rem}
</style>
</head>
<body>

<!-- LOGIN -->
<section id="login" class="login">
  <div class="panel">
    <h1>Accesso</h1>
    <p class="note">Inserisci credenziali.</p>
    <div class="row" style="margin-top:8px">
      <label>Utente <input id="username" type="text" autocomplete="username"/></label>
      <label>Password <input id="password" type="password" autocomplete="current-password"/></label>
    </div>
    <div style="margin-top:10px"><button onclick="login()">Entra</button></div>
  </div>
</section>

<!-- APP -->
<section id="app" style="display:none">
  <div class="wrap">
    <div class="card">
      <h1>Rapporto di Sopralluogo</h1>
      <div class="note">D.Lgs. 81/08 ‚Äì RSPP</div>
      <div class="row" style="margin-top:10px">
        <label>Sito <input id="sito" type="text" placeholder="Stabilimento"/></label>
        <label>Data <input id="data" type="date"/></label>
        <label>Datore di Lavoro <input id="datore" type="text"/></label>
        <label>RSPP (int./est.) <input id="rspp" type="text"/></label>
        <label>Collab./Lavoratori esterni <input id="collab" type="text"/></label>
      </div>
      <div class="note" style="margin-top:8px"><b>SI</b>=conforme, <b>NO</b>=non conforme, <b>N.A.</b>=non applicabile. Se ‚ÄúValido fino a‚Äù √® vuoto, nel PDF verr√† inserito ‚ÄúN.A.‚Äù</div>
    </div>

    <div class="card">
      <h3>Checklist generale</h3>
      <div id="checklist-generale"></div>
    </div>

    <div class="card">
      <h3>Valutazioni specifiche</h3>
      <div id="checklist-specifiche"></div>
    </div>

    <div class="card">
      <h3>Relazione breve</h3>
      <textarea id="relazione" placeholder="Annotazioni"></textarea>
    </div>

    <div class="card">
      <h3>Firme</h3>
      <div class="row" style="gap:16px">
        <div>
          <div>Firma RSPP</div>
          <canvas id="firmaRspp" width="360" height="120"></canvas><br/>
          <button class="secondary" type="button" onclick="clearFirma('firmaRspp')">Cancella</button>
        </div>
        <div>
          <div>Firma Datore di Lavoro</div>
          <canvas id="firmaDatore" width="360" height="120"></canvas><br/>
          <button class="secondary" type="button" onclick="clearFirma('firmaDatore')">Cancella</button>
        </div>
      </div>
    </div>

    <div class="card" style="display:flex;gap:10px;flex-wrap:wrap">
      <button onclick="salvaBozza()">üíæ Salva bozza</button>
      <button class="secondary" onclick="caricaBozza()">üìÇ Carica bozza</button>
      <button onclick="generaPDF()">üìÑ Genera PDF</button>
    </div>
  </div>
</section>

<script src="pdfmake.min.js"></script>
<script src="vfs_fonts.js"></script>
<script src="script.js?v=7" defer></script>
</body>
</html>
